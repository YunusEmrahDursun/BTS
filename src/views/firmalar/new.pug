extends ../dashboard/layout
block content
  .block-header
    .row.clearfix
      .col-md-6.col-sm-12
        h1=title
        nav(aria-label='breadcrumb')
          ol.breadcrumb
            li.breadcrumb-item
              |  BTS
            li.breadcrumb-item.active(aria-current='page')=title
  .row.clearfix
    .col-lg-12.col-md-12
      .card  
        ul.nav.nav-tabs2
          li.nav-item
            a.nav-link.show( href='/web/table/'+data.table)=title +" Tablosu"
          li.nav-item
            a.nav-link.active( href='#')="Kayıt Ekle"
        .tab-content    
          .tab-content
            .body
              form.form-auth-small.m-t-20(novalidate data-parsley-validate onsubmit="formValitdate(this);return false;")
                include ../components/inputGen
                .col-12
                  .form-group.mt-3.mb-5
                    .dropify-wrapper
                      .dropify-message
                        span.file-icon
                        p Dosyaları buraya sürükleyin veya bir dosya seçmek için tıklayın
                        p.dropify-error Birşeyler ters gitti!
                      .dropify-loader
                      .dropify-errors-container
                        ul
                      input.dropify(type='file' callback="firmaDosyası" table="firma_dosya_table" target= )
                      button.dropify-clear(type='button') Sil
                      .dropify-preview
                        span.dropify-render
                        .dropify-infos
                          .dropify-infos-inner
                            p.dropify-filename
                              span.file-icon
                              span.dropify-filename-inner
                            p.dropify-infos-message Dosyaları buraya sürükleyin veya bir dosya seçmek için tıklayın
                .col-12
                  #upladedFiles            
                .col-12
                  button.btn.btn-primary(type='submit') Kaydet
                  a(href='/web/table/'+data.table)
                    button.btn.btn-secondary(type='button' ) Vazgeç
                  if targetData && targetData[data.idColName] && targetData[data.idColName] != ""   
                    .float-right    
                      button.btn.btn-danger(type='button' onclick=`Http.Delete('/api/${data.table}/delete/${targetData[data.idColName]}',formBasarili)`) Sil
  script.
    function firmaDosyası(data){
      console.log(data)
    }
    function formBasarili(obj){
      if(obj.status==1){
        setTimeout(()=>{
            showNotification(obj.message,"success");
            location.href="/web/table/#{data.table}";
        },1000)
      }else{
        showNotification(obj.message,"error");
      }

    }
  if targetData && targetData[data.idColName] && targetData[data.idColName] != "" 
    script.     
      function formValitdate(e){
          try {
            var form = $(e);
            form.parsley().validate();
            if(form.parsley().isValid()){
              Http.Put('/api/!{data.table}/update/!{targetData[data.idColName]}',collectData("f"),formBasarili)
            }
          }catch(e){
            console.log(e);
          }
            
      } 
  else 
    script.     
      function formValitdate(e){
          try {
            var form = $(e);
            form.parsley().validate();
            if(form.parsley().isValid()){
              Http.Post('/api/!{data.table}/add',collectData("f"),formBasarili)
            }
          }catch(e){
            console.log(e);
          }
            
      } 
